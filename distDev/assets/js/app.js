"use strict";

// set main global variables
var trademachines;
var elem = {};
var domReady = function domReady(callback) {
	document.readyState === "interactive" || document.readyState === "complete" ? callback() : document.addEventListener("DOMContentLoaded", callback);
};

(function () {
	'use strict';

	// global object used to initialize functions

	trademachines = {
		// set global DOM elements and global variables

		initDom: function initDom() {
			elem.postList = document.querySelector('.post-list');
			elem.headerSearch = document.querySelector('.header-search-field');
			elem.viewSwitchGrid = document.querySelector('.js-switch-grid');
			elem.viewSwitchList = document.querySelector('.js-switch-list');
			elem.ajaxFireCount = 0;
			elem.tagList;
			elem.postImageList;
		},
		// here we can put all the events
		events: function events() {
			// search event
			elem.headerSearch.onkeyup = ajaxSearch;
			function ajaxSearch(e) {
				var searchVal = e.target.value;
				trademachines.loadAJAX(searchVal);
			}

			elem.viewSwitchGrid.addEventListener('click', function (e) {
				if (!elem.postList.classList.contains('grid-view')) {
					elem.postList.classList.add('grid-view');
				}
				elem.postList.classList.remove('list-view');
			});
			elem.viewSwitchList.addEventListener('click', function (e) {
				if (!elem.postList.classList.contains('list-view')) {
					elem.postList.classList.add('list-view');
				}
				elem.postList.classList.remove('grid-view');
			});
			function switchListView(e) {}
		},
		loadAJAX: function loadAJAX() {
			var searchVal = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;


			// Create a connection by using built in tool XMLHttpRequest
			var ourRequest = new XMLHttpRequest();

			// Set up a connection either GET or POST
			ourRequest.open('GET', 'https://jsonplaceholder.typicode.com/posts');

			// when something returs
			ourRequest.onload = function () {
				// checking id the ajax response what successgull
				if (ourRequest.readyState == 4 && ourRequest.status == 200) {
					// Tell the browser what kind of data it should expect and how to interpret it
					var ourData = JSON.parse(ourRequest.responseText);
					// running the render function, passing the data and the value
					trademachines.renderList(ourData, searchVal);
				} else {
					console.log('Server returned an error');
				}
			};
			// when nothing returns
			ourRequest.onerror = function () {
				console.log('AJAX failed');
			};

			// senging the request
			ourRequest.send();
		},
		renderList: function renderList(data) {
			var searchVal = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;

			// preparing the regexpression for the input fields
			var searchExp = new RegExp(searchVal, '');
			// output variables will be used to print HTML into the List
			var output = "";
			// setting up flags to prevent the 2 list (tags abd images) from beeing recreated on every renderList call
			if (elem.ajaxFireCount == 0) {
				elem.tagList = trademachines.getRandomNounList(data.length);
				elem.postImageList = trademachines.getRandomImages(data.length);
			}
			elem.ajaxFireCount++;
			// adding short names for our tags abd image lists
			var randomNames = elem.tagList;
			var randomImages = elem.postImageList;

			// looping through our returned ajax data object
			for (var post in data) {
				var postData = data[post];
				var tagItem = randomNames['item' + post];

				// filtering the list
				if (postData.title.search(searchExp) != -1 || searchVal == false) {
					output += '<li class="ccol-xs-6 col-sm-4 col-lg-4 media post-list-item">';
					output += "<div class=\"post-list-image\"><img class=\"img-fluid\" src=\"" + randomImages[post] + "\" alt=\"Generic placeholder image\"></div>";
					output += '<div class="media-body">';
					output += "<h5>" + postData.title + "</h5>";
					output += "<ul class=\"nav tag-list\">";
					for (var i = 0; tagItem.length > i; i++) {
						output += "<li class=\"nav-item tag-list-item\"><a class=\"nav-link active\" href=\"#\"><i class=\"icon-tag\"></i>" + tagItem[i] + "</a></li>";
					}
					output += '</ul>';
					output += "<p>" + postData.body + "</p>";
					output += '<div class="post-list-action"><a href="#" class="btn btn-primary">Call to Action</a></div>';
					output += '</div>';
					output += '<li>';
				}
			}
			// printing the output into DOM
			elem.postList.innerHTML = output;
		},

		// function used for getting a random number in a specified range
		getRandomInt: function getRandomInt(min, max) {
			return Math.floor(Math.random() * (max - min + 1)) + min;
		},

		// generating the Tag list
		getRandomNounList: function getRandomNounList() {
			var arrayLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5;

			var nouns = ['women', 'men', 'children', 'teeth', 'feet', 'people', 'leaves', 'mice', 'geese', 'halves', 'knives', 'wives', 'lives', 'elves', 'loaves', 'potatoes', 'tomatoes', 'cacti', 'foci', 'fungi', 'nuclei', 'syllabuses', 'analyses', 'diagnoses', 'oases', 'theses', 'crises', 'phenomena', 'criteria', 'data'];
			var list = [];
			var listObj = {};
			function randomNoun() {
				return nouns[Math.floor(Math.random() * nouns.length)];
			}
			for (var i = 0; arrayLength > i; i++) {
				var nameList = [];
				for (var ii = 0; trademachines.getRandomInt(1, 3) > ii; ii++) {
					nameList.push(randomNoun());
				}

				listObj['item' + i] = nameList;
			}
			return listObj;
		},

		//generating the image list
		getRandomImages: function getRandomImages() {
			var arrayLength = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 5;

			var images = [];

			for (var i = 0; arrayLength > i; i++) {
				images.push("https://unsplash.it/300/300?image=" + trademachines.getRandomInt(800, 900));
			}
			return images;
		}
	};

	// Loading function on DOM Ready
	domReady(function () {
		trademachines.initDom();
		trademachines.events();
		trademachines.loadAJAX();
	});
})(document);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJ0cmFkZW1hY2hpbmVzIiwiZWxlbSIsImRvbVJlYWR5IiwiY2FsbGJhY2siLCJkb2N1bWVudCIsInJlYWR5U3RhdGUiLCJhZGRFdmVudExpc3RlbmVyIiwiaW5pdERvbSIsInBvc3RMaXN0IiwicXVlcnlTZWxlY3RvciIsImhlYWRlclNlYXJjaCIsInZpZXdTd2l0Y2hHcmlkIiwidmlld1N3aXRjaExpc3QiLCJhamF4RmlyZUNvdW50IiwidGFnTGlzdCIsInBvc3RJbWFnZUxpc3QiLCJldmVudHMiLCJvbmtleXVwIiwiYWpheFNlYXJjaCIsImUiLCJzZWFyY2hWYWwiLCJ0YXJnZXQiLCJ2YWx1ZSIsImxvYWRBSkFYIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJhZGQiLCJyZW1vdmUiLCJzd2l0Y2hMaXN0VmlldyIsIm91clJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWQiLCJzdGF0dXMiLCJvdXJEYXRhIiwiSlNPTiIsInBhcnNlIiwicmVzcG9uc2VUZXh0IiwicmVuZGVyTGlzdCIsImNvbnNvbGUiLCJsb2ciLCJvbmVycm9yIiwic2VuZCIsImRhdGEiLCJzZWFyY2hFeHAiLCJSZWdFeHAiLCJvdXRwdXQiLCJnZXRSYW5kb21Ob3VuTGlzdCIsImxlbmd0aCIsImdldFJhbmRvbUltYWdlcyIsInJhbmRvbU5hbWVzIiwicmFuZG9tSW1hZ2VzIiwicG9zdCIsInBvc3REYXRhIiwidGFnSXRlbSIsInRpdGxlIiwic2VhcmNoIiwiaSIsImJvZHkiLCJpbm5lckhUTUwiLCJnZXRSYW5kb21JbnQiLCJtaW4iLCJtYXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJhcnJheUxlbmd0aCIsIm5vdW5zIiwibGlzdCIsImxpc3RPYmoiLCJyYW5kb21Ob3VuIiwibmFtZUxpc3QiLCJpaSIsInB1c2giLCJpbWFnZXMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQSxJQUFJQSxhQUFKO0FBQ0EsSUFBSUMsT0FBTyxF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LEVBQWtDQSxHQUFsQyxFQUFzQztBQUNyQyxRQUFJYyxXQUFXLEVBQWY7QUFDQSxTQUFNLElBQUlDLEtBQUssQ0FBZixFQUFrQnhFLGNBQWM0RCxZQUFkLENBQTJCLENBQTNCLEVBQThCLENBQTlCLElBQW1DWSxFQUFyRCxFQUF5REEsSUFBekQsRUFBOEQ7QUFDN0RELGNBQVNFLElBQVQsQ0FBY0gsWUFBZDtBQUNBOztBQUVERCxZQUFRLFNBQVNaLENBQWpCLElBQXNCYyxRQUF0QjtBQUNBO0FBQ0QsVUFBT0YsT0FBUDtBQUNBLEdBbEljOztBQW9JZjtBQUNBcEIsbUJBQWlCLDJCQUEwQjtBQUFBLE9BQWpCaUIsV0FBaUIsdUVBQUgsQ0FBRzs7QUFDMUMsT0FBSVEsU0FBUyxFQUFiOztBQUVBLFFBQUssSUFBSWpCLElBQUksQ0FBYixFQUFnQlMsY0FBY1QsQ0FBOUIsRUFBaUNBLEdBQWpDLEVBQXFDO0FBQ3BDaUIsV0FBT0QsSUFBUCx3Q0FBaUR6RSxjQUFjNEQsWUFBZCxDQUEyQixHQUEzQixFQUFnQyxHQUFoQyxDQUFqRDtBQUNBO0FBQ0QsVUFBT2MsTUFBUDtBQUNBO0FBNUljLEVBQWhCOztBQStJQTtBQUNBeEUsVUFBUyxZQUFXO0FBQ25CRixnQkFBY08sT0FBZDtBQUNHUCxnQkFBY2dCLE1BQWQ7QUFDQWhCLGdCQUFjdUIsUUFBZDtBQUNILEVBSkQ7QUFLQSxDQXpKRCxFQXlKR25CLFFBekpIIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHNldCBtYWluIGdsb2JhbCB2YXJpYWJsZXNcbnZhciB0cmFkZW1hY2hpbmVzO1xudmFyIGVsZW0gPSB7fTtcbnZhciBkb21SZWFkeSA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJpbnRlcmFjdGl2ZVwiIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgPT09IFwiY29tcGxldGVcIiA/IGNhbGxiYWNrKCkgOiBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBjYWxsYmFjayk7XG59O1xuXG4oZnVuY3Rpb24oKXtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIGdsb2JhbCBvYmplY3QgdXNlZCB0byBpbml0aWFsaXplIGZ1bmN0aW9uc1xuXHR0cmFkZW1hY2hpbmVzID0ge1xuXHRcdC8vIHNldCBnbG9iYWwgRE9NIGVsZW1lbnRzIGFuZCBnbG9iYWwgdmFyaWFibGVzXG5cblx0XHRpbml0RG9tOiBmdW5jdGlvbiAoKSB7XHRcblx0XHRcdGVsZW0ucG9zdExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9zdC1saXN0Jyk7XG5cdFx0XHRlbGVtLmhlYWRlclNlYXJjaCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXItc2VhcmNoLWZpZWxkJyk7XG5cdFx0XHRlbGVtLnZpZXdTd2l0Y2hHcmlkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLXN3aXRjaC1ncmlkJyk7XG5cdFx0XHRlbGVtLnZpZXdTd2l0Y2hMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLXN3aXRjaC1saXN0Jyk7XG5cdFx0XHRlbGVtLmFqYXhGaXJlQ291bnQgPSAwO1xuXHRcdFx0ZWxlbS50YWdMaXN0O1xuXHRcdFx0ZWxlbS5wb3N0SW1hZ2VMaXN0O1xuXHRcdH0sXG5cdFx0Ly8gaGVyZSB3ZSBjYW4gcHV0IGFsbCB0aGUgZXZlbnRzXG5cdCAgICBldmVudHM6IGZ1bmN0aW9uICgpIHtcblx0ICAgIFx0Ly8gc2VhcmNoIGV2ZW50XG5cdCAgICBcdGVsZW0uaGVhZGVyU2VhcmNoLm9ua2V5dXAgPSBhamF4U2VhcmNoO1xuXHQgICAgXHRmdW5jdGlvbiBhamF4U2VhcmNoKGUpIHtcblx0ICAgIFx0XHR2YXIgc2VhcmNoVmFsID0gZS50YXJnZXQudmFsdWU7XG5cdCAgICBcdFx0dHJhZGVtYWNoaW5lcy5sb2FkQUpBWChzZWFyY2hWYWwpO1xuXHQgICAgXHR9XG5cblx0ICAgIFx0ZWxlbS52aWV3U3dpdGNoR3JpZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuXHQgICAgXHRcdGlmKCFlbGVtLnBvc3RMaXN0LmNsYXNzTGlzdC5jb250YWlucygnZ3JpZC12aWV3Jykpe1xuXHQgICAgXHRcdFx0ZWxlbS5wb3N0TGlzdC5jbGFzc0xpc3QuYWRkKCdncmlkLXZpZXcnKTtcblx0ICAgIFx0XHR9XG5cdCAgICBcdFx0ZWxlbS5wb3N0TGlzdC5jbGFzc0xpc3QucmVtb3ZlKCdsaXN0LXZpZXcnKTtcblx0ICAgIFx0fSk7XG5cdCAgICBcdGVsZW0udmlld1N3aXRjaExpc3QuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKXtcblx0ICAgIFx0XHRpZighZWxlbS5wb3N0TGlzdC5jbGFzc0xpc3QuY29udGFpbnMoJ2xpc3QtdmlldycpKXtcblx0ICAgIFx0XHRcdGVsZW0ucG9zdExpc3QuY2xhc3NMaXN0LmFkZCgnbGlzdC12aWV3Jyk7XG5cdCAgICBcdFx0fVxuXHQgICAgXHRcdGVsZW0ucG9zdExpc3QuY2xhc3NMaXN0LnJlbW92ZSgnZ3JpZC12aWV3Jyk7XG5cdCAgICBcdH0pO1xuXHQgICAgXHRmdW5jdGlvbiBzd2l0Y2hMaXN0VmlldyhlKXtcblx0ICAgIFx0XHRcblx0ICAgIFx0fVxuXHQgICAgfSxcblx0ICAgIGxvYWRBSkFYOiBmdW5jdGlvbihzZWFyY2hWYWwgPSBmYWxzZSl7XG5cdCAgICBcdFxuXHQgICAgXHQvLyBDcmVhdGUgYSBjb25uZWN0aW9uIGJ5IHVzaW5nIGJ1aWx0IGluIHRvb2wgWE1MSHR0cFJlcXVlc3Rcblx0XHRcdHZhciBvdXJSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cblx0ICAgIFx0Ly8gU2V0IHVwIGEgY29ubmVjdGlvbiBlaXRoZXIgR0VUIG9yIFBPU1Rcblx0XHRcdG91clJlcXVlc3Qub3BlbignR0VUJywgJ2h0dHBzOi8vanNvbnBsYWNlaG9sZGVyLnR5cGljb2RlLmNvbS9wb3N0cycpO1xuXG5cdFx0XHQvLyB3aGVuIHNvbWV0aGluZyByZXR1cnNcblx0XHRcdG91clJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24gKCkge1xuXHRcdFx0XHQvLyBjaGVja2luZyBpZCB0aGUgYWpheCByZXNwb25zZSB3aGF0IHN1Y2Nlc3NndWxsXG5cdFx0XHRcdGlmIChvdXJSZXF1ZXN0LnJlYWR5U3RhdGUgPT0gNCAmJiBvdXJSZXF1ZXN0LnN0YXR1cyA9PSAyMDApIHtcblx0XHRcdFx0XHQvLyBUZWxsIHRoZSBicm93c2VyIHdoYXQga2luZCBvZiBkYXRhIGl0IHNob3VsZCBleHBlY3QgYW5kIGhvdyB0byBpbnRlcnByZXQgaXRcblx0XHRcdFx0XHR2YXIgb3VyRGF0YSA9IEpTT04ucGFyc2Uob3VyUmVxdWVzdC5yZXNwb25zZVRleHQpO1xuXHRcdFx0XHRcdC8vIHJ1bm5pbmcgdGhlIHJlbmRlciBmdW5jdGlvbiwgcGFzc2luZyB0aGUgZGF0YSBhbmQgdGhlIHZhbHVlXG5cdFx0XHRcdFx0dHJhZGVtYWNoaW5lcy5yZW5kZXJMaXN0KG91ckRhdGEsIHNlYXJjaFZhbCk7XG5cdFx0XHRcdH0gZWxzZXtcblx0XHRcdFx0XHRjb25zb2xlLmxvZygnU2VydmVyIHJldHVybmVkIGFuIGVycm9yJyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0XG5cdFx0XHR9O1xuXHRcdFx0Ly8gd2hlbiBub3RoaW5nIHJldHVybnNcblx0XHRcdG91clJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdBSkFYIGZhaWxlZCcpO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzZW5naW5nIHRoZSByZXF1ZXN0XG5cdFx0XHRvdXJSZXF1ZXN0LnNlbmQoKTtcblx0ICAgIH0sXG5cdCAgICByZW5kZXJMaXN0OiBmdW5jdGlvbihkYXRhLCBzZWFyY2hWYWw9IGZhbHNlKXtcblx0ICAgIFx0Ly8gcHJlcGFyaW5nIHRoZSByZWdleHByZXNzaW9uIGZvciB0aGUgaW5wdXQgZmllbGRzXG5cdCAgICBcdHZhciBzZWFyY2hFeHAgPSBuZXcgUmVnRXhwKHNlYXJjaFZhbCwgJycpO1xuXHQgICAgXHQvLyBvdXRwdXQgdmFyaWFibGVzIHdpbGwgYmUgdXNlZCB0byBwcmludCBIVE1MIGludG8gdGhlIExpc3Rcblx0ICAgIFx0dmFyIG91dHB1dCA9IFwiXCI7XG5cdCAgICBcdC8vIHNldHRpbmcgdXAgZmxhZ3MgdG8gcHJldmVudCB0aGUgMiBsaXN0ICh0YWdzIGFiZCBpbWFnZXMpIGZyb20gYmVlaW5nIHJlY3JlYXRlZCBvbiBldmVyeSByZW5kZXJMaXN0IGNhbGxcblx0ICAgIFx0aWYoZWxlbS5hamF4RmlyZUNvdW50ID09IDApe1xuXHQgICAgXHRcdGVsZW0udGFnTGlzdCA9IHRyYWRlbWFjaGluZXMuZ2V0UmFuZG9tTm91bkxpc3QoZGF0YS5sZW5ndGgpO1xuXHQgICAgXHRcdGVsZW0ucG9zdEltYWdlTGlzdCA9IHRyYWRlbWFjaGluZXMuZ2V0UmFuZG9tSW1hZ2VzKGRhdGEubGVuZ3RoKTtcblx0ICAgIFx0fVxuXHQgICAgXHRlbGVtLmFqYXhGaXJlQ291bnQgKys7XG5cdCAgICBcdC8vIGFkZGluZyBzaG9ydCBuYW1lcyBmb3Igb3VyIHRhZ3MgYWJkIGltYWdlIGxpc3RzXG5cdCAgICBcdHZhciByYW5kb21OYW1lcyA9IGVsZW0udGFnTGlzdDtcblx0ICAgIFx0dmFyIHJhbmRvbUltYWdlcyA9IGVsZW0ucG9zdEltYWdlTGlzdDtcblxuXHQgICAgXHQvLyBsb29waW5nIHRocm91Z2ggb3VyIHJldHVybmVkIGFqYXggZGF0YSBvYmplY3Rcblx0ICAgIFx0Zm9yICh2YXIgcG9zdCBpbiBkYXRhKSB7XG5cdCAgICBcdFx0dmFyIHBvc3REYXRhID0gZGF0YVtwb3N0XTtcblx0ICAgIFx0XHR2YXIgdGFnSXRlbSA9IHJhbmRvbU5hbWVzWydpdGVtJyArIHBvc3RdO1xuXG5cdCAgICBcdFx0Ly8gZmlsdGVyaW5nIHRoZSBsaXN0XG5cdCAgICBcdFx0aWYgKChwb3N0RGF0YS50aXRsZS5zZWFyY2goc2VhcmNoRXhwKSAhPSAtMSkgfHwgKHNlYXJjaFZhbCA9PSBmYWxzZSkpe1xuXHRcdCAgICBcdFx0b3V0cHV0ICs9ICc8bGkgY2xhc3M9XCJjY29sLXhzLTYgY29sLXNtLTQgY29sLWxnLTQgbWVkaWEgcG9zdC1saXN0LWl0ZW1cIj4nO1xuXHRcdCAgICBcdFx0b3V0cHV0ICs9IGA8ZGl2IGNsYXNzPVwicG9zdC1saXN0LWltYWdlXCI+PGltZyBjbGFzcz1cImltZy1mbHVpZFwiIHNyYz1cIiR7cmFuZG9tSW1hZ2VzW3Bvc3RdfVwiIGFsdD1cIkdlbmVyaWMgcGxhY2Vob2xkZXIgaW1hZ2VcIj48L2Rpdj5gO1xuXHRcdCAgICBcdFx0b3V0cHV0ICs9ICc8ZGl2IGNsYXNzPVwibWVkaWEtYm9keVwiPic7XG5cdFx0ICAgIFx0XHRvdXRwdXQgKz0gYDxoNT4ke3Bvc3REYXRhLnRpdGxlfTwvaDU+YDtcblx0XHQgICAgXHRcdG91dHB1dCArPSBgPHVsIGNsYXNzPVwibmF2IHRhZy1saXN0XCI+YDtcblx0XHQgICAgXHRcdGZvciAodmFyIGkgPSAwOyB0YWdJdGVtLmxlbmd0aCA+IGk7IGkrKyl7XG5cdFx0ICAgIFx0XHRcdG91dHB1dCArPSBgPGxpIGNsYXNzPVwibmF2LWl0ZW0gdGFnLWxpc3QtaXRlbVwiPjxhIGNsYXNzPVwibmF2LWxpbmsgYWN0aXZlXCIgaHJlZj1cIiNcIj48aSBjbGFzcz1cImljb24tdGFnXCI+PC9pPiR7dGFnSXRlbVtpXX08L2E+PC9saT5gO1xuXHRcdCAgICBcdFx0fVxuXHRcdCAgICBcdFx0b3V0cHV0ICs9ICc8L3VsPic7XG5cdFx0ICAgIFx0XHRvdXRwdXQgKz0gYDxwPiR7cG9zdERhdGEuYm9keX08L3A+YDtcblx0XHQgICAgXHRcdG91dHB1dCArPSAnPGRpdiBjbGFzcz1cInBvc3QtbGlzdC1hY3Rpb25cIj48YSBocmVmPVwiI1wiIGNsYXNzPVwiYnRuIGJ0bi1wcmltYXJ5XCI+Q2FsbCB0byBBY3Rpb248L2E+PC9kaXY+Jztcblx0XHQgICAgXHRcdG91dHB1dCArPSAnPC9kaXY+Jztcblx0XHQgICAgXHRcdG91dHB1dCArPSAnPGxpPic7XG5cdFx0ICAgIFx0fVxuXHQgICAgXHR9XG5cdCAgICBcdC8vIHByaW50aW5nIHRoZSBvdXRwdXQgaW50byBET01cblx0XHRcdGVsZW0ucG9zdExpc3QuaW5uZXJIVE1MID0gb3V0cHV0O1xuXG5cdCAgICB9LFxuXG5cdCAgICAvLyBmdW5jdGlvbiB1c2VkIGZvciBnZXR0aW5nIGEgcmFuZG9tIG51bWJlciBpbiBhIHNwZWNpZmllZCByYW5nZVxuXHQgICAgZ2V0UmFuZG9tSW50OiBmdW5jdGlvbihtaW4sIG1heCkge1xuXHRcdCAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSkgKyBtaW47XG5cdFx0fSxcblxuXHRcdC8vIGdlbmVyYXRpbmcgdGhlIFRhZyBsaXN0XG5cdFx0Z2V0UmFuZG9tTm91bkxpc3Q6IGZ1bmN0aW9uKGFycmF5TGVuZ3RoID0gNSkge1xuXHRcdCBcdHZhciBub3VucyA9IFsnd29tZW4nLCAnbWVuJywgJ2NoaWxkcmVuJywgJ3RlZXRoJywgJ2ZlZXQnLCAncGVvcGxlJywgJ2xlYXZlcycsICdtaWNlJywgJ2dlZXNlJywgJ2hhbHZlcycsICdrbml2ZXMnLCAnd2l2ZXMnLCAnbGl2ZXMnLCAnZWx2ZXMnLCAnbG9hdmVzJywgJ3BvdGF0b2VzJywgJ3RvbWF0b2VzJywgJ2NhY3RpJywgJ2ZvY2knLCAnZnVuZ2knLCAnbnVjbGVpJywgJ3N5bGxhYnVzZXMnLCAnYW5hbHlzZXMnLCAnZGlhZ25vc2VzJywgJ29hc2VzJywgJ3RoZXNlcycsICdjcmlzZXMnLCAncGhlbm9tZW5hJywgJ2NyaXRlcmlhJywgJ2RhdGEnXTtcblx0XHQgXHR2YXIgbGlzdCA9IFtdO1xuXHRcdCBcdHZhciBsaXN0T2JqID0ge307XG5cdFx0IFx0ZnVuY3Rpb24gcmFuZG9tTm91bigpe1xuXHRcdFx0XHRyZXR1cm4gbm91bnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbm91bnMubGVuZ3RoKV07XG5cdFx0XHR9XG5cdFx0XHRmb3IgKCB2YXIgaSA9IDA7IGFycmF5TGVuZ3RoID4gaTsgaSsrKXtcblx0XHRcdFx0dmFyIG5hbWVMaXN0ID0gW107XG5cdFx0XHRcdGZvciAoIHZhciBpaSA9IDA7IHRyYWRlbWFjaGluZXMuZ2V0UmFuZG9tSW50KDEsIDMpID4gaWk7IGlpKyspe1xuXHRcdFx0XHRcdG5hbWVMaXN0LnB1c2gocmFuZG9tTm91bigpKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGxpc3RPYmpbJ2l0ZW0nICsgaV0gPSBuYW1lTGlzdDtcblx0XHRcdH1cblx0XHRcdHJldHVybiBsaXN0T2JqO1xuXHRcdH0sXG5cblx0XHQvL2dlbmVyYXRpbmcgdGhlIGltYWdlIGxpc3Rcblx0XHRnZXRSYW5kb21JbWFnZXM6IGZ1bmN0aW9uKGFycmF5TGVuZ3RoID0gNSkge1xuXHRcdFx0dmFyIGltYWdlcyA9IFtdO1xuXG5cdFx0XHRmb3IgKHZhciBpID0gMDsgYXJyYXlMZW5ndGggPiBpOyBpKyspe1xuXHRcdFx0XHRpbWFnZXMucHVzaChgaHR0cHM6Ly91bnNwbGFzaC5pdC8zMDAvMzAwP2ltYWdlPSR7dHJhZGVtYWNoaW5lcy5nZXRSYW5kb21JbnQoODAwLCA5MDApfWApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIGltYWdlc1xuXHRcdH1cblx0fTtcblxuXHQvLyBMb2FkaW5nIGZ1bmN0aW9uIG9uIERPTSBSZWFkeVxuXHRkb21SZWFkeShmdW5jdGlvbigpIHtcblx0XHR0cmFkZW1hY2hpbmVzLmluaXREb20oKTtcblx0ICAgIHRyYWRlbWFjaGluZXMuZXZlbnRzKCk7XG5cdCAgICB0cmFkZW1hY2hpbmVzLmxvYWRBSkFYKCk7XG5cdH0pO1xufSkoZG9jdW1lbnQpO1xuIl19
